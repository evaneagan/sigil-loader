class SigilLoader{constructor(e={}){this.config={selector:e.selector||".loader",percentSelector:e.percentSelector||".loading-percent",imageSelector:e.imageSelector||"img[data-loader]",skipOnRepeat:e.skipOnRepeat??!0,delay:e.delay??.5,milestones:e.milestones||{fonts:20,dom:20,images:40,unicorn:20},animation:{duration:.5,ease:"power2.out",snap:{innerText:1},...e.animation},hooks:{onStart:e.hooks?.onStart||null,onMilestone:e.hooks?.onMilestone||null,onComplete:e.hooks?.onComplete||null}},this.milestones={},this.targetProgress=0,this.displayedProgress=0,this.animationTween=null;for(const e in this.config.milestones)this.milestones[e]={done:!1,weight:this.config.milestones[e]};this.$loader=document.querySelector(this.config.selector),this.$percent=document.querySelector(this.config.percentSelector)}init(){this.config.skipOnRepeat&&localStorage.getItem("hasVisited")?this._skipLoader():(localStorage.setItem("hasVisited","true"),document.body.classList.add("loading"),setTimeout((()=>{"function"==typeof this.config.hooks.onStart&&this.config.hooks.onStart(),this._setupDOMListener(),this._setupFontListener(),this._setupImageLoader(),this._setupUnicornLoader()}),1e3*this.config.delay))}_skipLoader(){this.$loader&&(this.$loader.style.display="none"),document.body.classList.remove("loading")}setMilestone(e){const t=this.milestones[e];if(!t||t.done)return;t.done=!0;let o=0;for(const e in this.milestones)this.milestones[e].done&&(o+=this.milestones[e].weight);this.targetProgress=o,this._animateProgress(),"function"==typeof this.config.hooks.onMilestone&&this.config.hooks.onMilestone(e,this.targetProgress)}_animateProgress(){this.animationTween&&this.animationTween.kill();const e=this.displayedProgress,t=this.targetProgress,o=()=>{this.animationTween=gsap.to({value:e},{value:t,duration:this.config.animation.duration,ease:this.config.animation.ease,snap:this.config.animation.snap,onUpdate:()=>{this.displayedProgress=this.animationTween.targets()[0].value,this.$percent.innerText=`${Math.round(this.displayedProgress)}%`},onComplete:()=>{Math.round(this.displayedProgress)>=100&&this._destroy()}})};"function"==typeof this.config.animation.animateProgress?this.config.animation.animateProgress({from:e,to:t,element:this.$percent,onComplete:()=>{Math.round(t)>=100&&this._destroy()}}):o()}_destroy(){"function"==typeof this.config.hooks.onComplete&&this.config.hooks.onComplete()}_setupDOMListener(){"interactive"===document.readyState||"complete"===document.readyState?this.setMilestone("dom"):document.addEventListener("DOMContentLoaded",(()=>{this.setMilestone("dom")}))}_setupFontListener(){document.fonts&&document.fonts.ready?document.fonts.ready.then((()=>{this.setMilestone("fonts")})):this.setMilestone("fonts")}_setupImageLoader(){const e=document.querySelectorAll(this.config.imageSelector),t=e.length;if(0===t)return void this.setMilestone("images");let o=0;const s=()=>{o++;const e=o/t,s=this.milestones.images.weight*e,i=Object.keys(this.milestones).reduce(((e,t)=>"images"===t?e:this.milestones[t].done?e+this.milestones[t].weight:e),0);this.targetProgress=i+s,this._animateProgress(),o===t&&this.setMilestone("images")};e.forEach((e=>{e.complete?s():(e.addEventListener("load",s),e.addEventListener("error",s))}))}_setupUnicornLoader(){this.milestones.unicorn&&("undefined"!=typeof UnicornStudio&&"function"==typeof UnicornStudio.init?UnicornStudio.init().then((()=>this.setMilestone("unicorn"))).catch((e=>{console.warn("UnicornStudio failed to load:",e),this.setMilestone("unicorn")})):this.setMilestone("unicorn"))}}