<!DOCTYPE html>
<html class="preload">
<head>
  <meta charset="UTF-8">
  <title>Sigil Loader Test</title>
  <style>
    body.loading {
      overflow: hidden;
    }
    .preload .loader {
      display: none;
    }
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: black;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-size: 2rem;
      transition: background-color 0.3s ease;
    }
  </style>
</head>
<body class="loading">

  <!-- Loader -->
  <div class="loader">
    <div class="loading-percent">0%</div>
  </div>

  <!-- Sample content -->
  <img data-loader src="https://via.placeholder.com/600x400?text=Image+1" alt="Test 1">
  <img data-loader src="https://via.placeholder.com/600x400?text=Image+2" alt="Test 2">
  <img data-loader src="https://via.placeholder.com/600x400?text=Image+3" alt="Test 3">

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>

  <!-- Sigil Loader -->
  <script src="./dist/sigil-loader.min.js"></script>

  <script>
    const loader = new SigilLoader({
      selector: ".loader",
      percentSelector: ".loading-percent",
      imageSelector: "img[data-loader]",
      skipOnRepeat: false, // always show loader during testing
      delay: 0.5,
      milestones: {
        fonts: 20,
        dom: 20,
        images: 20,
        unicorn: 40,
      },
      animation: {
        animateProgress: ({ from, to, element, onComplete }) => {

          gsap.fromTo(
            element,
            { textContent: from },
            {
              textContent: to,
              duration: 2,
              ease: "power2.inOut",
              snap: { textContent: 1 },
              onUpdate: function () {
                const value = Math.round(this.targets()[0].textContent);
                element.innerText = `${value}%`;
              },
              onComplete
            }
          );
        }
      },
      hooks: {
        onStart: () => console.log("Loader started"),
        onMilestone: (key, progress) => console.log(`Milestone: ${key} â†’ ${progress}%`),
        onComplete: () => {
          console.log("Loader complete");

          // Step 1: Turn background red
          gsap.to(loader.config.selector, {
            backgroundColor: "red",
            duration: 1.4,
            onComplete: () => {
              // Step 2: Fade out and scale
              gsap.to(loader.config.selector, {
              autoAlpha: 0,
              scale: 0.95,
              duration: 0.6,
              ease: "power2.inOut",
              onComplete: () => {
                document.body.classList.remove("loading");
              }
              });
            }
          });
        },
      }
    });
  
    loader.init();
  
  </script>
</body>
</html>
